<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A Botnet's Search for MikroTik Routers | malwaremily</title><meta name=keywords content="MikroTik,GCP,honeypot,GSM,RouterOS,Remco Verhoef,miner,botnet,honeypot logs,Cisco Talos,Coinhive"><meta name=description content="An Analysis of a Reoccuring Security Event"><meta name=author content="malwaremily"><link rel=canonical href=https://malwaremily.com/posts/011-microtik/><meta name=google-site-verification content="G-ZSJEE4YGQQ"><link href=/assets/css/stylesheet.min.2a79645f388444ef452f62dadbadeebdfebba13b08d1b841a7504a7be022e74d.css integrity="sha256-KnlkXziERO9FL2La263uvf67oTsI0bhBp1BKe+Ai500=" rel="preload stylesheet" as=style><link rel=icon href=https://malwaremily.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://malwaremily.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://malwaremily.com/favicon.ico><link rel=apple-touch-icon href=https://malwaremily.com/favicon.ico><link rel=mask-icon href=https://malwaremily.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-ZSJEE4YGQQ','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="A Botnet's Search for MikroTik Routers"><meta property="og:description" content="An Analysis of a Reoccuring Security Event"><meta property="og:type" content="article"><meta property="og:url" content="https://malwaremily.com/posts/011-microtik/"><meta property="og:image" content="https://malwaremily.com/img/011-log01.png"><meta property="article:published_time" content="2021-02-02T00:00:03+00:00"><meta property="article:modified_time" content="2021-02-02T00:00:03+00:00"><meta property="og:site_name" content="malwaremily"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://malwaremily.com/img/011-log01.png"><meta name=twitter:title content="A Botnet's Search for MikroTik Routers"><meta name=twitter:description content="An Analysis of a Reoccuring Security Event"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A Botnet's Search for MikroTik Routers","name":"A Botnet\u0027s Search for MikroTik Routers","description":"Last Updated: 2021-02-04\nLast month, I wrote a post about setting up honeypots on GCP where I stood up a low-interaction SSH honeypot. Since then, I\u0026amp;rsquo;ve been able to log a few …","keywords":["MikroTik","GCP","honeypot","GSM","RouterOS","Remco Verhoef","miner","botnet","honeypot logs","Cisco Talos","Coinhive"],"articleBody":"Last Updated: 2021-02-04\nLast month, I wrote a post about setting up honeypots on GCP where I stood up a low-interaction SSH honeypot. Since then, I’ve been able to log a few megabytes worth of unauthorized behavior. This post will report on a repeated security event targeting misconfigured MikroTik routers.\n Event Behavior The attacker logs into the honeypot using admin/password and then sends the commands seen below into the honeypot terminal. Several IP addresses have been logged exhibiting the same command entry patterns suggesting botnet activity. These source IPs are shared at the end of the post.\n/ip cloud print ifconfig uname -a cat /proc/cpuinfo ps | grep '[Mm]iner' ps -ef | grep '[Mm]iner' ls -la /dev/ttyGSM* /dev/ttyUSB-mod* /var/spool/sms/* /var/log/smsd.log /etc/smsd.conf* /usr/bin/qmuxd /var/qmux_connect_socket /etc/config/simman /dev/modem* /var/config/sms/* echo Hi | cat -n  Observations In order to try to attribute a malware campaign to this behavior, we must analyze the movements by the attacking entity. This section discusses observations relating the commands used to potential motives in an attempt to learn more about the event behavior.\n/ip cloud print The command /ip cloud print prints the parameters set for RouterOS, the OS used by MikroTik devices. You can read about this command in the MikroTik wiki. Other tools using this command have not yet been identified, in accoradance with this, the command may be specific to MikroTik devices. MikroTik is a popluar networking vendor in Latvia. We will touch on MikroTik later on in this post.\nifconfig, uname, /proc/cpuinfo The attackers search for ifconfig, uname, and proc/cpuinfo, in that order. ifconfig prints networking information. When called with no flags information about connected network interfaces are printed to the console, including your IP address and what kind of network interaces are available/active. Some network interfaces can give clues about the envronment a device is running in. For example, running ifconfig in a GCP Ubuntu 18.04 VM returns the lo loopback interface and ens4. Machines with Docker installed with show docker0.\nuname print basic system information. uname -a will print all system information. On a GCP Ubuntu 18.04 VM uname -a returns:\n$ uname -a Linux monitor 4.15.0-1091-gcp #104~16.04.1-Ubuntu SMP Tue Dec 15 19:05:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux cat /proc/cpuinfo prints CPU information to the screen. Here is an example of output on a GCP Ubuntu 18.04 VM:\nThese commands are used to gather information about the device.\nps -ef | grep '[Mm]iner' The ps command will print running process and along with some information about them. The -ef flags will print every process using the standard sytax where -e selects all processes and -f triggers full-format listing. It is interesting that both ps and ps -ef are used in the event. An example of the differences between the two commands is shown on a GCP Ubuntu 18.04 VM below:\nPiping the active process output to grep [Mm]iner will return all processes with the word miner or Miner in them. This behavior may indicate the attacker is searching for active cryptominers running on the misconfigured system. Normally, running this command on say a GCP Ubunt 18.04 VM would return nothing, example below:\nls -la /dev/ttyGSM* /dev/ttyUSB-mod* ... The botnet uses ls -la to search for specific set of system files. I’ve associated the requested files with potential related router services and listed the results the table below.\n   FILE SERVICE     /dev/ttyGSM* GSM   /dev/ttyUSB-mod* GSM   /var/spool/sms/* SMS   /var/log/smsd.log SMS   /etc/smsd.conf* SMS   /usr/bin/qmuxd QMUX   /var/qmux_connect_socket QMUX   /etc/config/simman Unknown/SIM Card   /dev/modem* GSM   /var/config/sms/* SMS    SMS Yes, SMS like text messages. SMS stands for short message service used by mobile device and internet-connected devices. MikroTik supports sending SMS messages via GSM modem. Users report configuring their MikroTik to use text messages for router management including receiving health alert text messages from the router and/or being able to reset the admin/user password via SMS. See the MikroTik Wiki for more information.\nGSM GSM stands for Global System for Mobile Communications. GSM is the standard protocol for mobile communications. On a Mikrotik Router /dev/ttyGSM* may return the virtual serial ports in use by the RouterOS modem (kernel.org, 2011). Users in StackExchange discuss gaining a direct serial connection to a RB4011 MikroTik router using sudo screen /dev/ttyUSB0 115200 cs8 ixoff implying that ls -la /dev/ttyUSB* can be used to identify a live serial connection to an active router.\nQMUX /usr/bin/qmuxd points to the QMUX daemon. gmuxd is a linux user-space process to multiplex between programs interfacing with QMI (Qualcomm MSM Interface) and one or more shared-memory based QMUX ports offered by the broadband processor (Osmocom,2019). This Github issue from 2017 suggests it is related to critical modem-related messaging services. This other issue cites qmuxd as being the daemon responsible for talking to the modem via shared memory on Android.\n/etc/config/simman Limited information on /etc/config/simman was discovered on common search engines. For instance, DuckDuckGo will only return 2 unique results. The only conclusive results returned with this string were live honeypot dashboards and websites written in Russian. I’ve translated the relevant results below.\n  Как изменить APN? : Техническая поддержка nano /etc/config/simman. Меняем параметры option GPRS_apn. config sim0 option priority ‘1’ option GPRS_apn ‘tele91.msk’ config sim1 option priority ‘0’ option GPRS_apn ‘tele91.msk’ Сохраняем файл с настройками: Ctrl+X потом подтверждаем сохранение под тем же именем\n  How to change APN?: Technical Support nano / etc / config / simman. Change the parameters of option GPRS_apn. config sim0 option priority ‘1’ option GPRS_apn ‘tele91.msk’ config sim1 option priority ‘0’ option GPRS_apn ‘tele91.msk’ Save the settings file: Ctrl + X then confirm saving under the same name\n   Настройки Менеджера SIM карт : Техническая поддержка Для настройки Менеджера SIM с помощью консоли, необходимо открыть файл /etc/config/simman: nano /etc/config/simman. В открывшемся окне Вы можете произвести конфигурацию: config simman ‘core’\n  SIM Card Manager Settings: Technical Support To configure the SIM Manager using the console, open the file /etc/config/simman: nano /etc/config/simman. In the window that opens, you can configure: config simman ‘core’\n  This was an additional result returned from Google:\n Роутеры TELEOFIS RTU968, RTU1068 V2. Руководство …\n  Routers TELEOFIS RTU968, RTU1068 V2. Manual …\n  The translated results suggest the botnet is checking for the existence of a configuration file related to SIM card management.\nOn a new GCP Ubuntu 18.04 VM the same la -la command returns no file matches: echo Hi | cat -n To help explain this behavior, I’ve displayed the expected output of echo Hi | cat -n.\n$echo Hi | cat -n 1 Hi Why would a robot want to print “Hi” to console? Let’s take a step back and look at the series of commands executed. The commands first search for information about the machine with ifconfig and uname. It looks for running processes with ‘miner’ in their process name. It checks for specific files, all checks that will fail on the honeypot. After executing these commands, the unauthorized entity prints a greeting to standard out in an unusual manner.\nOne explaination is that after determining the machine is a honeypot the botnet leaves a mark to record it has identified the machine as a honeypot. The mark could be a flag to prevent the botnet from dropping their malware on research honeypots.\n Analysis Related Security Researcher Reports Similar behavior has been previously reported by security researcher @remco_verhoef. On June 13th 2018 Verhoef writes,\n “We’ve found interesting new traffic within our Honeytrap agents, originating from servers within Russia only (to be specific, the netblock owned by NKS / NCNET Broadband)… they are executing all of the following ssh commands:\"(SANS, 2018)\n /ip cloud print help ifconfig uname -a show ip cat /proc/cpuinfo uptime ls -la ls /data/data/com.android.providers.telephony/databases echo Hi | cat -n ps | grep '[Mm]iner' ps -ef | grep '[Mm]iner' In his post, Verhoef notes that since RouterOS v6.27 the /ip cloud print command has deprecated indicating that the targetted devices are those running software older than v6.27. Verhoef adds that because, “not all of the above commands are programmed to return the output expected by the script, it could be just probing for specifics about the attacked server,” (SANS, 2018).\nMikroTik \u0026 Coinhive Campaign Reports MikroTik is a router vender used Eastern Europe, based in Latvia. On May 23rd 2018, Cisco Talos reported that some MikroTik devices are vulnerable to VPNFilter malware, they warn routers were being compromised by Coinhive cryptocurrency malware. Talos identifies MikroTik RouterOS versions 1016, 1036, and 1072 for cloud core routers as vulnerable.\nTwo days later on May 25th, 2018 the FBI issued a public service announcement summarizing,\n “Foreign cyber actors have compromised hundreds of thousands of home and office routers and other networked devices worldwide. The actors used VPNFilter malware to target small office and home office routers. The malware is able to perform multiple functions, including possible information collection, device exploitation, and blocking network traffic.”\n Analyst Opinion The security event analyzed in this post has been executed numerous times by several IP addresses on the HoneyTrap server hosted in GCP. The botnet appears quite active, crawling the internet for RouterOS devices with a weak username and password configuration. The motive of these events has not been confirmed, however, as suggested by the FBI there are numerous malicious operations that could be conducted on a compromised router.\nLogged IP Addresses Remember, botnets may operate from compromised endpoints. This means the IPs listed below may not necessarily be the endpoint of the “real” attacking entity, but could instead potentially be zombified victim endpoints or VPN endpoints.\nThe event described in this post has been captured multiple times by the following addresses:\n51.222.139.65 174.124.123.109 185.110.91.235 The event described in this post is associated with the following hosts once:\n5.228.46.151 83.165.192.43 97.121.144.188 98.125.186.145 162.104.171.249 176.31.46.240 188.32.225.20 219.94.94.161 ","wordCount":"1605","inLanguage":"en","image":"https://malwaremily.com/img/011-log01.png","datePublished":"2021-02-02T00:00:03Z","dateModified":"2021-02-02T00:00:03Z","author":{"@type":"Person","name":"malwaremily"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://malwaremily.com/posts/011-microtik/"},"publisher":{"@type":"Organization","name":"malwaremily","logo":{"@type":"ImageObject","url":"https://malwaremily.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://malwaremily.com/ accesskey=h title="Home (Alt + H)"><img src=coffeaarabica400x400.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://malwaremily.com/about/ title=ABOUT><span>ABOUT</span></a></li><li><a href=https://malwaremily.com/archives/ title=ARCHIVES><span>ARCHIVES</span></a></li><li><a href=https://malwaremily.com/search/ title="SEARCH (Alt + /)" accesskey=/><span>SEARCH</span></a></li><li><a href=https://malwaremily.com/tags/ title=TAGS><span>TAGS</span></a></li><li><a href=https://malwaremily.com title=HOME><span>HOME</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>A Botnet's Search for MikroTik Routers</h1><div class=post-description>An Analysis of a Reoccuring Security Event</div><div class=post-meta>February 2, 2021&nbsp;·&nbsp;8 min</div></header><figure class=entry-cover><img src=https://malwaremily.com/img/011-log01.png alt="Honeypot Logs"><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><blockquote><ul><li><a href=#event-behavior aria-label="Event Behavior">Event Behavior</a></li><li><a href=#observations aria-label=Observations>Observations</a><ul><li><a href=#ip-cloud-print aria-label="/ip cloud print"><code>/ip cloud print</code></a></li><li><a href=#ifconfig-uname-proccpuinfo aria-label="ifconfig, uname, /proc/cpuinfo"><code>ifconfig</code>, <code>uname</code>, <code>/proc/cpuinfo</code></a></li><li><a href=#ps--ef--grep-mminer aria-label="ps -ef | grep '[Mm]iner'"><code>ps -ef | grep '[Mm]iner'</code></a></li><li><a href=#ls--la-devttygsm-devttyusb-mod- aria-label="ls -la /dev/ttyGSM* /dev/ttyUSB-mod* ..."><code>ls -la /dev/ttyGSM* /dev/ttyUSB-mod* ...</code></a><ul><li><a href=#sms aria-label=SMS>SMS</a></li><li><a href=#gsm aria-label=GSM>GSM</a></li><li><a href=#qmux aria-label=QMUX>QMUX</a></li><li><a href=#etcconfigsimman aria-label=/etc/config/simman>/etc/config/simman</a></li></ul></li><li><a href=#echo-hi--cat--n aria-label="echo Hi | cat -n"><code>echo Hi | cat -n</code></a></li></ul></li><li><a href=#analysis aria-label=Analysis>Analysis</a><ul><li><a href=#related-security-researcher-reports aria-label="Related Security Researcher Reports">Related Security Researcher Reports</a></li></ul></li><li><a href=#mikrotik--coinhive-campaign-reports aria-label="MikroTik &amp;amp; Coinhive Campaign Reports">MikroTik & Coinhive Campaign Reports</a></li><li><a href=#analyst-opinion aria-label="Analyst Opinion">Analyst Opinion</a></li><li><a href=#logged-ip-addresses aria-label="Logged IP Addresses">Logged IP Addresses</a></li></ul></blockquote></details></div><div class=post-content><p>Last Updated: 2021-02-04</p><p>Last month, I wrote a post about setting up honeypots on GCP where I stood up a low-interaction SSH honeypot. Since then, I&rsquo;ve been able to log a few megabytes worth of unauthorized behavior. This post will report on a repeated security event targeting misconfigured MikroTik routers.</p><hr><h1 id=event-behavior>Event Behavior<a hidden class=anchor aria-hidden=true href=#event-behavior>#</a></h1><p>The attacker logs into the honeypot using <code>admin/password</code> and then sends the commands seen below into the honeypot terminal. Several IP addresses have been logged exhibiting the same command entry patterns suggesting botnet activity. These source IPs are shared at the end of the post.</p><pre><code>/ip cloud print
ifconfig
uname -a
cat /proc/cpuinfo
ps | grep '[Mm]iner'
ps -ef | grep '[Mm]iner'
ls -la /dev/ttyGSM* /dev/ttyUSB-mod* /var/spool/sms/* /var/log/smsd.log /etc/smsd.conf* /usr/bin/qmuxd /var/qmux_connect_socket /etc/config/simman /dev/modem* /var/config/sms/*
echo Hi | cat -n
</code></pre><hr><h1 id=observations>Observations<a hidden class=anchor aria-hidden=true href=#observations>#</a></h1><p>In order to try to attribute a malware campaign to this behavior, we must analyze the movements by the attacking entity. This section discusses observations relating the commands used to potential motives in an attempt to learn more about the event behavior.</p><h2 id=ip-cloud-print><code>/ip cloud print</code><a hidden class=anchor aria-hidden=true href=#ip-cloud-print>#</a></h2><p>The command <code>/ip cloud print</code> prints the parameters set for RouterOS, the OS used by MikroTik devices. You can read about this command in the <a href=https://wiki.mikrotik.com/wiki/Manual:IP/Cloud>MikroTik wiki</a>. Other tools using this command have not yet been identified, in accoradance with this, the command may be specific to MikroTik devices. MikroTik is a popluar networking vendor in Latvia. We will touch on MikroTik later on in this post.</p><h2 id=ifconfig-uname-proccpuinfo><code>ifconfig</code>, <code>uname</code>, <code>/proc/cpuinfo</code><a hidden class=anchor aria-hidden=true href=#ifconfig-uname-proccpuinfo>#</a></h2><p>The attackers search for <code>ifconfig</code>, <code>uname</code>, and <code>proc/cpuinfo</code>, in that order. <code>ifconfig</code> prints networking information. When called with no flags information about connected network interfaces are printed to the console, including your IP address and what kind of network interaces are available/active. Some network interfaces can give clues about the envronment a device is running in. For example, running <code>ifconfig</code> in a GCP Ubuntu 18.04 VM returns the <code>lo</code> loopback interface and <code>ens4</code>. Machines with Docker installed with show <code>docker0</code>.</p><p><code>uname</code> print basic system information. <code>uname -a</code> will print all system information. On a GCP Ubuntu 18.04 VM <code>uname -a</code> returns:</p><pre><code>$ uname -a
Linux monitor 4.15.0-1091-gcp #104~16.04.1-Ubuntu SMP Tue Dec 15 19:05:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p><code>cat /proc/cpuinfo</code> prints CPU information to the screen. Here is an example of output on a GCP Ubuntu 18.04 VM:</p><p><img src=/img/011-cpuinfo.png alt="cat /proc/cpuinfo output"></p><p>These commands are used to gather information about the device.</p><h2 id=ps--ef--grep-mminer><code>ps -ef | grep '[Mm]iner'</code><a hidden class=anchor aria-hidden=true href=#ps--ef--grep-mminer>#</a></h2><p>The <code>ps</code> command will print running process and along with some information about them. The <code>-ef</code> flags will print every process using the standard sytax where <code>-e</code> selects all processes and <code>-f</code> triggers full-format listing. It is interesting that both <code>ps</code> and <code>ps -ef</code> are used in the event. An example of the differences between the two commands is shown on a GCP Ubuntu 18.04 VM below:</p><p><img src=/img/011-psdiff.png alt="ps versus ps -ef output"></p><p>Piping the active process output to <code>grep [Mm]iner</code> will return all processes with the word <code>miner</code> or <code>Miner</code> in them. This behavior may indicate the attacker is searching for active cryptominers running on the misconfigured system. Normally, running this command on say a GCP Ubunt 18.04 VM would return nothing, example below:</p><p><img src=/img/011-emptyps.png alt="empty ps"></p><h2 id=ls--la-devttygsm-devttyusb-mod-><code>ls -la /dev/ttyGSM* /dev/ttyUSB-mod* ...</code><a hidden class=anchor aria-hidden=true href=#ls--la-devttygsm-devttyusb-mod->#</a></h2><p>The botnet uses <code>ls -la</code> to search for specific set of system files. I&rsquo;ve associated the requested files with potential related router services and listed the results the table below.</p><table><thead><tr><th>FILE</th><th>SERVICE</th></tr></thead><tbody><tr><td><code>/dev/ttyGSM*</code></td><td>GSM</td></tr><tr><td><code>/dev/ttyUSB-mod*</code></td><td>GSM</td></tr><tr><td><code>/var/spool/sms/*</code></td><td>SMS</td></tr><tr><td><code>/var/log/smsd.log</code></td><td>SMS</td></tr><tr><td><code>/etc/smsd.conf*</code></td><td>SMS</td></tr><tr><td><code>/usr/bin/qmuxd</code></td><td>QMUX</td></tr><tr><td><code>/var/qmux_connect_socket</code></td><td>QMUX</td></tr><tr><td><code>/etc/config/simman</code></td><td>Unknown/SIM Card</td></tr><tr><td><code>/dev/modem*</code></td><td>GSM</td></tr><tr><td><code>/var/config/sms/*</code></td><td>SMS</td></tr></tbody></table><h3 id=sms>SMS<a hidden class=anchor aria-hidden=true href=#sms>#</a></h3><p>Yes, SMS like text messages. SMS stands for short message service used by mobile device and internet-connected devices. MikroTik supports sending SMS messages via GSM modem. Users report configuring their MikroTik to use text messages for router management including receiving health alert text messages from the router and/or being able to reset the admin/user password via SMS. See the MikroTik <a href=https://wiki.mikrotik.com/wiki/Manual:Tools/Sms>Wiki</a> for more information.</p><h3 id=gsm>GSM<a hidden class=anchor aria-hidden=true href=#gsm>#</a></h3><p>GSM stands for Global System for Mobile Communications. GSM is the standard protocol for mobile communications. On a Mikrotik Router <code>/dev/ttyGSM*</code> may return the virtual serial ports in use by the RouterOS modem (<a href=https://www.kernel.org/doc/html/v5.3/driver-api/serial/n_gsm.html>kernel.org</a>, 2011). Users in <a href=https://unix.stackexchange.com/questions/535906/direct-serial-connection-to-a-router-using-screen-command>StackExchange</a> discuss gaining a direct serial connection to a RB4011 MikroTik router using <code>sudo screen /dev/ttyUSB0 115200 cs8 ixoff</code> implying that <code>ls -la /dev/ttyUSB*</code> can be used to identify a live serial connection to an active router.</p><h3 id=qmux>QMUX<a hidden class=anchor aria-hidden=true href=#qmux>#</a></h3><p><code>/usr/bin/qmuxd</code> points to the QMUX daemon. <code>gmuxd</code> is a linux user-space process to multiplex between programs interfacing with QMI (Qualcomm MSM Interface) and one or more shared-memory based QMUX ports offered by the broadband processor (<a href=https://osmocom.org/projects/quectel-modems/wiki/Qmuxd>Osmocom</a>,2019). This <a href=https://github.com/postmarketOS/pmbootstrap/issues/1054>Github issue</a> from 2017 suggests it is related to critical modem-related messaging services. This other <a href=https://github.com/postmarketOS/pmbootstrap/issues/598>issue</a> cites <code>qmuxd</code> as being the daemon responsible for talking to the modem via shared memory on Android.</p><h3 id=etcconfigsimman>/etc/config/simman<a hidden class=anchor aria-hidden=true href=#etcconfigsimman>#</a></h3><p>Limited information on <code>/etc/config/simman</code> was discovered on common search engines. For instance, DuckDuckGo will only return 2 unique results. The only conclusive results returned with this string were live honeypot dashboards and websites written in Russian. I&rsquo;ve translated the relevant results below.</p><p><img src=/img/011-simman1.png alt="simman search photo 1"></p><hr><blockquote><p>Как изменить APN? : Техническая поддержка
nano /etc/config/simman. Меняем параметры option GPRS_apn. config sim0 option priority &lsquo;1&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; config sim1 option priority &lsquo;0&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; Сохраняем файл с настройками: Ctrl+X потом подтверждаем сохранение под тем же именем</p></blockquote><blockquote><p>How to change APN?: Technical Support
nano / etc / config / simman. Change the parameters of option GPRS_apn. config sim0 option priority &lsquo;1&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; config sim1 option priority &lsquo;0&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; Save the settings file: Ctrl + X then confirm saving under the same name</p></blockquote><hr><blockquote><p>Настройки Менеджера SIM карт : Техническая поддержка
Для настройки Менеджера SIM с помощью консоли, необходимо открыть файл /etc/config/simman: nano /etc/config/simman. В открывшемся окне Вы можете произвести конфигурацию: config simman &lsquo;core&rsquo;</p></blockquote><blockquote><p>SIM Card Manager Settings: Technical Support
To configure the SIM Manager using the console, open the file /etc/config/simman: nano /etc/config/simman. In the window that opens, you can configure: config simman &lsquo;core&rsquo;</p></blockquote><hr><p>This was an additional result returned from Google:</p><blockquote><p>Роутеры TELEOFIS RTU968, RTU1068 V2. Руководство &mldr;</p></blockquote><blockquote><p>Routers TELEOFIS RTU968, RTU1068 V2. Manual &mldr;</p></blockquote><hr><p>The translated results suggest the botnet is checking for the existence of a configuration file related to SIM card management.</p><p>On a new GCP Ubuntu 18.04 VM the same <code>la -la</code> command returns no file matches:
<img src=/img/011-lsla.png alt="ls -la output"></p><h2 id=echo-hi--cat--n><code>echo Hi | cat -n</code><a hidden class=anchor aria-hidden=true href=#echo-hi--cat--n>#</a></h2><p>To help explain this behavior, I&rsquo;ve displayed the expected output of <code>echo Hi | cat -n</code>.</p><pre><code>$echo Hi | cat -n
1 Hi
</code></pre><p>Why would a robot want to print &ldquo;Hi&rdquo; to console? Let&rsquo;s take a step back and look at the series of commands executed. The commands first search for information about the machine with <code>ifconfig</code> and <code>uname</code>. It looks for running processes with &lsquo;miner&rsquo; in their process name. It checks for specific files, all checks that will fail on the honeypot. After executing these commands, the unauthorized entity prints a greeting to standard out in an unusual manner.</p><p>One explaination is that after determining the machine is a honeypot the botnet leaves a mark to record it has identified the machine as a honeypot. The mark could be a flag to prevent the botnet from dropping their malware on research honeypots.</p><hr><h1 id=analysis>Analysis<a hidden class=anchor aria-hidden=true href=#analysis>#</a></h1><h2 id=related-security-researcher-reports>Related Security Researcher Reports<a hidden class=anchor aria-hidden=true href=#related-security-researcher-reports>#</a></h2><p>Similar behavior has been previously reported by security researcher <a href=https://twitter.com/remco_verhoef>@remco_verhoef</a>. On June 13th 2018 Verhoef writes,</p><blockquote><p>&ldquo;We&rsquo;ve found interesting new traffic within our Honeytrap agents, originating from servers within Russia only (to be specific, the netblock owned by NKS / NCNET Broadband)&mldr; they are executing all of the following ssh commands:"(<a href=https://isc.sans.edu/forums/diary/From+Microtik+with+Love/23762/>SANS</a>, 2018)</p></blockquote><pre><code>/ip cloud print
help
ifconfig
uname -a
show ip
cat /proc/cpuinfo
uptime
ls -la
ls /data/data/com.android.providers.telephony/databases
echo Hi | cat -n
ps | grep '[Mm]iner'
ps -ef | grep '[Mm]iner'
</code></pre><p>In his post, Verhoef notes that since <code>RouterOS v6.27</code> the <code>/ip cloud print</code> command has deprecated indicating that the targetted devices are those running software older than <code>v6.27</code>. Verhoef adds that because, &ldquo;not all of the above commands are programmed to return the output expected by the script, it could be just probing for specifics about the attacked server,&rdquo; (<a href=https://isc.sans.edu/forums/diary/From+Microtik+with+Love/23762/>SANS</a>, 2018).</p><h1 id=mikrotik--coinhive-campaign-reports>MikroTik & Coinhive Campaign Reports<a hidden class=anchor aria-hidden=true href=#mikrotik--coinhive-campaign-reports>#</a></h1><p>MikroTik is a router vender used Eastern Europe, based in Latvia. On May 23rd 2018, <a href=https://blog.talosintelligence.com/2018/05/VPNFilter.html>Cisco Talos</a> reported that some MikroTik devices are vulnerable to VPNFilter malware, they warn routers were being compromised by Coinhive cryptocurrency malware. Talos identifies MikroTik RouterOS versions 1016, 1036, and 1072 for cloud core routers as vulnerable.</p><p>Two days later on May 25th, 2018 the FBI issued a <a href=https://www.ic3.gov/Media/Y2018/PSA180525>public service announcement</a> summarizing,</p><blockquote><p>&ldquo;Foreign cyber actors have compromised hundreds of thousands of home and office routers and other networked devices worldwide. The actors used VPNFilter malware to target small office and home office routers. The malware is able to perform multiple functions, including possible information collection, device exploitation, and blocking network traffic.&rdquo;</p></blockquote><h1 id=analyst-opinion>Analyst Opinion<a hidden class=anchor aria-hidden=true href=#analyst-opinion>#</a></h1><p>The security event analyzed in this post has been executed numerous times by several IP addresses on the HoneyTrap server hosted in GCP. The botnet appears quite active, crawling the internet for RouterOS devices with a weak username and password configuration. The motive of these events has not been confirmed, however, as suggested by the FBI there are numerous malicious operations that could be conducted on a compromised router.</p><h1 id=logged-ip-addresses>Logged IP Addresses<a hidden class=anchor aria-hidden=true href=#logged-ip-addresses>#</a></h1><p>Remember, botnets may operate from compromised endpoints. This means the IPs listed below may not necessarily be the endpoint of the &ldquo;real&rdquo; attacking entity, but could instead potentially be zombified victim endpoints or VPN endpoints.</p><p>The event described in this post has been captured multiple times by the following addresses:</p><pre><code>51.222.139.65
174.124.123.109
185.110.91.235
</code></pre><p>The event described in this post is associated with the following hosts once:</p><pre><code>5.228.46.151
83.165.192.43
97.121.144.188
98.125.186.145
162.104.171.249
176.31.46.240
188.32.225.20
219.94.94.161
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://malwaremily.com/tags/mikrotik/>MikroTik</a></li><li><a href=https://malwaremily.com/tags/gcp/>GCP</a></li><li><a href=https://malwaremily.com/tags/honeypot/>honeypot</a></li><li><a href=https://malwaremily.com/tags/gsm/>GSM</a></li><li><a href=https://malwaremily.com/tags/routeros/>RouterOS</a></li><li><a href=https://malwaremily.com/tags/remco-verhoef/>Remco Verhoef</a></li><li><a href=https://malwaremily.com/tags/miner/>miner</a></li><li><a href=https://malwaremily.com/tags/botnet/>botnet</a></li><li><a href=https://malwaremily.com/tags/honeypot-logs/>honeypot logs</a></li><li><a href=https://malwaremily.com/tags/cisco-talos/>Cisco Talos</a></li><li><a href=https://malwaremily.com/tags/coinhive/>Coinhive</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://malwaremily.com/>malwaremily</a></span>
<span>&#183;</span>
<span>Made with ♥ by Emily</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>