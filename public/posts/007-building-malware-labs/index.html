<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Malware Labs and Machines | malwaremily</title><meta name=keywords content="malware,labs,lubuntu,REMnux,vagrant"><meta name=description content="An overview on my home malware lab"><meta name=author content="malwaremily"><link rel=canonical href=https://malwaremily.com/posts/007-building-malware-labs/><meta name=google-site-verification content="G-ZSJEE4YGQQ"><link href=/assets/css/stylesheet.min.2a79645f388444ef452f62dadbadeebdfebba13b08d1b841a7504a7be022e74d.css integrity="sha256-KnlkXziERO9FL2La263uvf67oTsI0bhBp1BKe+Ai500=" rel="preload stylesheet" as=style><link rel=icon href=https://malwaremily.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://malwaremily.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://malwaremily.com/favicon.ico><link rel=apple-touch-icon href=https://malwaremily.com/favicon.ico><link rel=mask-icon href=https://malwaremily.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-ZSJEE4YGQQ','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Malware Labs and Machines"><meta property="og:description" content="An overview on my home malware lab"><meta property="og:type" content="article"><meta property="og:url" content="https://malwaremily.com/posts/007-building-malware-labs/"><meta property="og:image" content="https://malwaremily.com/img/007-MichaelDziedzic.png"><meta property="article:published_time" content="2021-01-28T00:00:03+00:00"><meta property="article:modified_time" content="2021-01-28T00:00:03+00:00"><meta property="og:site_name" content="malwaremily"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://malwaremily.com/img/007-MichaelDziedzic.png"><meta name=twitter:title content="Malware Labs and Machines"><meta name=twitter:description content="An overview on my home malware lab"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Malware Labs and Machines","name":"Malware Labs and Machines","description":"This post is geared towards beginners and documents the general steps I took to build a home malware lab.\nMalware Lab Plans The malware lab must meet the following requirements: …","keywords":["malware","labs","lubuntu","REMnux","vagrant"],"articleBody":"This post is geared towards beginners and documents the general steps I took to build a home malware lab.\nMalware Lab Plans The malware lab must meet the following requirements:\n Malware environment must not connect to prod/shared networks. Dedicated physical workstation to host malware lab. (i.e. an old laptop) Quickly restore host in the event of malware escape. Include both static and dynamic analysis features.  WARNING: Conduct all security research on an isolated network seperate from shared/personal devices. Failure to contain malware could result in damage to other devices on the same network and/or loss of data.\nHardware Requriements I want to analyze malware samples in a secured environment so that in the event of malware escape I can wipe the host machine with no impact to my personal data. A small home malware lab using a spare labtop should be enough for my personal security research. I’ve created a seperate, isolated network for the lab, monitored by an IPS. I also have a USB device that I will be using to install an OS on the spare laptop. The laptop specs are dual-core i5 with 8 GB of RAM. The laptop RAM can be upgraded to 32 GB of RAM, I plan on upgrading it to 16 GB or 32 GB at a later date. VirtualBox needs 512 MB of RAM and ~30MB of disk space– provided that I only use up to 7 GB of RAM, I should be okay to virtualize 2+ virtual machines (VMs) at a time.\nSoftware Requirements I am using Lubuntu, a lightweight version of Ubuntu, as the OS used to host the VMs. Lubuntu will allow me to allocate fewer resources to the OS than a regular Ubuntu so that I may allocate more resources to the VMs. The following technologies are installed:\n VirtualBox - to create virtual machines Vagrant - to manage virtual machines Docker - to create and manage containers  Singular Static \u0026 Dynamnic Analysis Machines For quick and easy forensic machines I use the REMnux Linux distribution. REMux is an Ubuntu 18.04 + GNOME base machine preloaded with forensic tools. Download the VirtualBox OVA from remnux.org. You can quickly launch this machine by double-clicking the ova file and configuring the imported machine. Once installed, login and update/upgrade. Then, change the network adapter to host-only in “Machine  Settings  Network”. Once the network has been isolated to the host, save a snapshot.\nsudo apt-get update sudo apt upgrade You can also install REMnux from source in your cloud forensic station:\nremnux install --mode cloud And/or you can run and install REMnux in a docker container:\ndocker run --rm -it -u remnux remnux/remnux-distro:focal bash REMnux provides many tools for static and dynamic analysis. If you’d like a full list check out the REMnux documentation. Generally, there are tools for PE and ELF files, Android files, static and dynamic analysis, network traffic analysis, deobfuscation tools, unpacking tools, etc. The REMnux machine can also then be reset and paired with a windows sandbox since it already has similated protocol tools for monitoring network behavior like fakenet, inetsim, and fakedns.\nWindows Sandbox Victim + Linux Machine Observer Modern malware checks its environment for signs its being observed. Using a sandboxed Windows environment allows us to execute malware and quietly observe the resulting changes to the environment. There are a couple of ways of going about this. We can grab a Windows development environment (~20GB) for testing from Microsoft. On this virtual machine we would then install tools (ProcessHacker, Process Monitor) to observe changes to the environment after the executable file is run. This machine would require at least 4 GB of RAM and 2 cores.\nThe REMnux machine can be used to observe the Windows sandbox. The virtual machines are both configured to share a virtual network isolated on the local host. The Windows machine is then set to point to the linux machine for networking services like DNS so that the linux machine captures relevent network data.\nAutomated Analysis with Third Parties We could also use a pre-built sandbox environment like cuckoo. Or if confidentiality is not an issue, you could upload the sample to VirusTotal, Hybrid Analysis, and/or Joes Sandbox.\n","wordCount":"698","inLanguage":"en","image":"https://malwaremily.com/img/007-MichaelDziedzic.png","datePublished":"2021-01-28T00:00:03Z","dateModified":"2021-01-28T00:00:03Z","author":{"@type":"Person","name":"malwaremily"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://malwaremily.com/posts/007-building-malware-labs/"},"publisher":{"@type":"Organization","name":"malwaremily","logo":{"@type":"ImageObject","url":"https://malwaremily.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://malwaremily.com/ accesskey=h title="Home (Alt + H)"><img src=coffeaarabica400x400.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://malwaremily.com/about/ title=ABOUT><span>ABOUT</span></a></li><li><a href=https://malwaremily.com/archives/ title=ARCHIVES><span>ARCHIVES</span></a></li><li><a href=https://malwaremily.com/search/ title="SEARCH (Alt + /)" accesskey=/><span>SEARCH</span></a></li><li><a href=https://malwaremily.com/tags/ title=TAGS><span>TAGS</span></a></li><li><a href=https://malwaremily.com title=HOME><span>HOME</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Malware Labs and Machines</h1><div class=post-description>An overview on my home malware lab</div><div class=post-meta>January 28, 2021&nbsp;·&nbsp;4 min</div></header><figure class=entry-cover><img src=https://malwaremily.com/img/007-MichaelDziedzic.png alt="Colored Visual Glitch"><p>Photo by <a href=https://unsplash.com/photos/0W4XLGITrHg>Michael Dziedzic</a> on Unsplash</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><blockquote><ul><li><a href=#malware-lab-plans aria-label="Malware Lab Plans">Malware Lab Plans</a></li><li><a href=#hardware-requriements aria-label="Hardware Requriements">Hardware Requriements</a></li><li><a href=#software-requirements aria-label="Software Requirements">Software Requirements</a></li><li><a href=#singular-static--dynamnic-analysis-machines aria-label="Singular Static &amp;amp; Dynamnic Analysis Machines">Singular Static & Dynamnic Analysis Machines</a></li><li><a href=#windows-sandbox-victim--linux-machine-observer aria-label="Windows Sandbox Victim + Linux Machine Observer">Windows Sandbox Victim + Linux Machine Observer</a></li><li><a href=#automated-analysis-with-third-parties aria-label="Automated Analysis with Third Parties">Automated Analysis with Third Parties</a></li></ul></blockquote></details></div><div class=post-content><p>This post is geared towards beginners and documents the general steps I took to build a home malware lab.</p><h2 id=malware-lab-plans>Malware Lab Plans<a hidden class=anchor aria-hidden=true href=#malware-lab-plans>#</a></h2><p>The malware lab must meet the following requirements:</p><ul><li>Malware environment must not connect to prod/shared networks.</li><li>Dedicated physical workstation to host malware lab. (i.e. an old laptop)</li><li>Quickly restore host in the event of malware escape.</li><li>Include both static and dynamic analysis features.</li></ul><p>WARNING: Conduct all security research on an isolated network seperate from shared/personal devices. Failure to contain malware could result in damage to other devices on the same network and/or loss of data.</p><h2 id=hardware-requriements>Hardware Requriements<a hidden class=anchor aria-hidden=true href=#hardware-requriements>#</a></h2><p>I want to analyze malware samples in a secured environment so that in the event of malware escape I can wipe the host machine with no impact to my personal data. A small home malware lab using a spare labtop should be enough for my personal security research. I&rsquo;ve created a seperate, isolated network for the lab, monitored by an IPS. I also have a USB device that I will be using to install an OS on the spare laptop. The laptop specs are dual-core i5 with 8 GB of RAM. The laptop RAM can be upgraded to 32 GB of RAM, I plan on upgrading it to 16 GB or 32 GB at a later date. VirtualBox needs 512 MB of RAM and ~30MB of disk space&ndash; provided that I only use up to 7 GB of RAM, I should be okay to virtualize 2+ virtual machines (VMs) at a time.</p><h2 id=software-requirements>Software Requirements<a hidden class=anchor aria-hidden=true href=#software-requirements>#</a></h2><p>I am using <a href=https://lubuntu.net/>Lubuntu</a>, a lightweight version of Ubuntu, as the OS used to host the VMs. Lubuntu will allow me to allocate fewer resources to the OS than a regular Ubuntu so that I may allocate more resources to the VMs. The following technologies are installed:</p><ul><li><a href=https://www.virtualbox.org/manual/ch02.html>VirtualBox</a> - to create virtual machines</li><li><a href=https://www.vagrantup.com/docs/installation>Vagrant</a> - to manage virtual machines</li><li><a href=https://docs.docker.com/get-docker/>Docker</a> - to create and manage containers</li></ul><h2 id=singular-static--dynamnic-analysis-machines>Singular Static & Dynamnic Analysis Machines<a hidden class=anchor aria-hidden=true href=#singular-static--dynamnic-analysis-machines>#</a></h2><p>For quick and easy forensic machines I use the REMnux Linux distribution. REMux is an Ubuntu 18.04 + GNOME base machine preloaded with forensic tools. Download the VirtualBox OVA from <a href=https://docs.remnux.org/install-distro/get-virtual-appliance>remnux.org</a>. You can quickly launch this machine by double-clicking the <code>ova</code> file and configuring the imported machine. Once installed, login and update/upgrade. Then, change the network adapter to host-only in &ldquo;Machine > Settings > Network&rdquo;. Once the network has been isolated to the host, save a snapshot.</p><pre><code>sudo apt-get update
sudo apt upgrade
</code></pre><p>You can also install REMnux from source in your cloud forensic station:</p><pre><code>remnux install --mode cloud
</code></pre><p>And/or you can run and install REMnux in a <a href=https://docs.remnux.org/install-distro/remnux-as-a-container>docker container</a>:</p><pre><code>docker run --rm -it -u remnux remnux/remnux-distro:focal bash
</code></pre><p>REMnux provides many tools for static and dynamic analysis. If you&rsquo;d like a full list check out the <a href=https://docs.remnux.org>REMnux documentation</a>. Generally, there are tools for PE and ELF files, Android files, static and dynamic analysis, network traffic analysis, deobfuscation tools, unpacking tools, etc. The REMnux machine can also then be reset and paired with a windows sandbox since it already has similated protocol tools for monitoring network behavior like <code>fakenet</code>, <code>inetsim</code>, and <code>fakedns</code>.</p><h2 id=windows-sandbox-victim--linux-machine-observer>Windows Sandbox Victim + Linux Machine Observer<a hidden class=anchor aria-hidden=true href=#windows-sandbox-victim--linux-machine-observer>#</a></h2><p>Modern malware checks its environment for signs its being observed. Using a sandboxed Windows environment allows us to execute malware and quietly observe the resulting changes to the environment. There are a couple of ways of going about this. We can grab a <a href=https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/>Windows development environment</a> (~20GB) for testing from Microsoft. On this virtual machine we would then install tools (ProcessHacker, Process Monitor) to observe changes to the environment after the executable file is run. This machine would require at least 4 GB of RAM and 2 cores.</p><p>The REMnux machine can be used to observe the Windows sandbox. The virtual machines are both configured to share a virtual network isolated on the local host. The Windows machine is then set to point to the linux machine for networking services like DNS so that the linux machine captures relevent network data.</p><h2 id=automated-analysis-with-third-parties>Automated Analysis with Third Parties<a hidden class=anchor aria-hidden=true href=#automated-analysis-with-third-parties>#</a></h2><p>We could also use a pre-built sandbox environment like <a href=https://cuckoosandbox.org/>cuckoo</a>. Or if confidentiality is not an issue, you could upload the sample to VirusTotal, Hybrid Analysis, and/or Joes Sandbox.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://malwaremily.com/tags/malware/>malware</a></li><li><a href=https://malwaremily.com/tags/labs/>labs</a></li><li><a href=https://malwaremily.com/tags/lubuntu/>lubuntu</a></li><li><a href=https://malwaremily.com/tags/remnux/>REMnux</a></li><li><a href=https://malwaremily.com/tags/vagrant/>vagrant</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://malwaremily.com/>malwaremily</a></span>
<span>&#183;</span>
<span>Made with ♥ by Emily</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>