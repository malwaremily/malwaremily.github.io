<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.88.1" />
  <link rel="canonical" href="/011-microtik/">

  
    
    <meta name="description" content="Last Updated: 2021-02-04
Last month, I wrote a post about setting up honeypots on GCP where I stood up a low-interaction SSH honeypot. Since then, I’ve been able to log a few megabytes worth of unauthorized behavior. This post will report on a repeated security event targeting misconfigured MikroTik routers.
 Event Behavior The attacker logs into the honeypot using admin/password and then sends the commands seen below into the honeypot terminal.">
  

  <link rel="apple-touch-icon" sizes="180x180" href="https://www.malwaremily.github.io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.malwaremily.github.io/favicon-32x32.png"> 
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.malwaremily.github.io/favicon-16x16.png"> 
  <link rel="manifest" href="https://www.malwaremily.github.io/site.webmanifest"> 
  <link rel="mask-icon" href="https://www.malwaremily.github.io/safari-pinned-tab.svg" color="#000000"> 
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }
  </style>

  <style id="darkTheme">
    .intro-and-nav,
    .main-and-footer {
      filter: invert(100%);
    }

    * {
      background-color: inherit
    }

    img:not([src*=".svg"]),
    .colors,
    iframe,
    .demo-container {
      filter: invert(100%);
    }
  </style>

  <link rel="stylesheet" href="/css/prism.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  
    <link rel="stylesheet" href="/css/custom_01.css">
  
    <link rel="stylesheet" href="/css/custom_02.css">
  

  
  
  <title>A Botnet&#39;s Search for MikroTik Routers | malwaremily</title>
</head>

  <body>
    <a href="#main">skip to content</a>
    <noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>

    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="https://www.malwaremily.github.io"
        aria-label="malwaremily home page"
      >
        <img 
          src="/images/logo.svg" 
          alt=" ">
      </a>
      <p class="library-desc">
         A defense security web log. 
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use xlink:href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/post/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Posts</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use xlink:href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>
    
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use xlink:href="#bookmark"></use>
      </svg>
      A Botnet&#39;s Search for MikroTik Routers
    </h1>

    <div class="date">
      
      
      <strong>Publish date: </strong>2021-02-02
      
        
          <br>
          <strong>Last updated: </strong>2021-09-20
        
      
    </div>

    
      <div class="tags">
        <strong>Tags: </strong>
        <ul aria-label="tags">
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/gcp/">gcp</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/honeypot/">honeypot</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/miner/">miner</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use xlink:href="#tag"></use>
              </svg>
              
              <a href="/tags/botnet/">botnet</a>
            </li>
          
        </ul>
      </div>
    

    


    <p>Last Updated: 2021-02-04</p>
<p>Last month, I wrote a post about setting up honeypots on GCP where I stood up a low-interaction SSH honeypot. Since then, I&rsquo;ve been able to log a few megabytes worth of unauthorized behavior. This post will report on a repeated security event targeting misconfigured MikroTik routers.</p>
<hr>
<h1 id="event-behavior">Event Behavior</h1>
<p>The attacker logs into the honeypot using <code>admin/password</code> and then sends the commands seen below into the honeypot terminal. Several IP addresses have been logged exhibiting the same command entry patterns suggesting botnet activity. These source IPs are shared at the end of the post.</p>
<pre><code>/ip cloud print
ifconfig
uname -a
cat /proc/cpuinfo
ps | grep '[Mm]iner'
ps -ef | grep '[Mm]iner'
ls -la /dev/ttyGSM* /dev/ttyUSB-mod* /var/spool/sms/* /var/log/smsd.log /etc/smsd.conf* /usr/bin/qmuxd /var/qmux_connect_socket /etc/config/simman /dev/modem* /var/config/sms/*
echo Hi | cat -n
</code></pre>
<hr>
<h1 id="observations">Observations</h1>
<p>In order to try to attribute a malware campaign to this behavior, we must analyze the movements by the attacking entity. This section discusses observations relating the commands used to potential motives in an attempt to learn more about the event behavior.</p>
<h2 id="ip-cloud-print"><code>/ip cloud print</code></h2>
<p>The command <code>/ip cloud print</code> prints the parameters set for RouterOS, the OS used by MikroTik devices. You can read about this command in the <a href="https://wiki.mikrotik.com/wiki/Manual:IP/Cloud">MikroTik wiki</a>. Other tools using this command have not yet been identified, in accoradance with this, the command may be specific to MikroTik devices. MikroTik is a popluar networking vendor in Latvia. We will touch on MikroTik later on in this post.</p>
<h2 id="ifconfig-uname-proccpuinfo"><code>ifconfig</code>, <code>uname</code>, <code>/proc/cpuinfo</code></h2>
<p>The attackers search for <code>ifconfig</code>, <code>uname</code>, and <code>proc/cpuinfo</code>, in that order. <code>ifconfig</code> prints networking information. When called with no flags information about connected network interfaces are printed to the console, including your IP address and what kind of network interaces are available/active. Some network interfaces can give clues about the envronment a device is running in. For example, running <code>ifconfig</code> in a GCP Ubuntu 18.04 VM returns the <code>lo</code> loopback interface and <code>ens4</code>. Machines with Docker installed with show <code>docker0</code>.</p>
<p><code>uname</code> print basic system information. <code>uname -a</code> will print all system information. On a GCP Ubuntu 18.04 VM <code>uname -a</code> returns:</p>
<pre><code>$ uname -a
Linux monitor 4.15.0-1091-gcp #104~16.04.1-Ubuntu SMP Tue Dec 15 19:05:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>
<p><code>cat /proc/cpuinfo</code> prints CPU information to the screen. Here is an example of output on a GCP Ubuntu 18.04 VM:</p>
<p><img src="/img/011-cpuinfo.png" alt="cat /proc/cpuinfo output"></p>
<p>These commands are used to gather information about the device.</p>
<h2 id="ps--ef--grep-mminer"><code>ps -ef | grep '[Mm]iner'</code></h2>
<p>The <code>ps</code> command will print running process and along with some information about them. The <code>-ef</code> flags will print every process using the standard sytax where <code>-e</code> selects all processes and <code>-f</code> triggers full-format listing. It is interesting that both <code>ps</code> and <code>ps -ef</code> are used in the event. An example of the differences between the two commands is shown on a GCP Ubuntu 18.04 VM below:</p>
<p><img src="/img/011-psdiff.png" alt="ps versus ps -ef output"></p>
<p>Piping the active process output to <code>grep [Mm]iner</code> will return all processes with the word <code>miner</code> or <code>Miner</code> in them. This behavior may indicate the attacker is searching for active cryptominers running on the misconfigured system. Normally, running this command on say a GCP Ubunt 18.04 VM would return nothing, example below:</p>
<p><img src="/img/011-emptyps.png" alt="empty ps"></p>
<h2 id="ls--la-devttygsm-devttyusb-mod-"><code>ls -la /dev/ttyGSM* /dev/ttyUSB-mod* ...</code></h2>
<p>The botnet uses <code>ls -la</code> to search for specific set of system files. I&rsquo;ve associated the requested files with potential related router services and listed the results the table below.</p>
<table>
<thead>
<tr>
<th>FILE</th>
<th>SERVICE</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dev/ttyGSM*</code></td>
<td>GSM</td>
</tr>
<tr>
<td><code>/dev/ttyUSB-mod*</code></td>
<td>GSM</td>
</tr>
<tr>
<td><code>/var/spool/sms/*</code></td>
<td>SMS</td>
</tr>
<tr>
<td><code>/var/log/smsd.log</code></td>
<td>SMS</td>
</tr>
<tr>
<td><code>/etc/smsd.conf*</code></td>
<td>SMS</td>
</tr>
<tr>
<td><code>/usr/bin/qmuxd</code></td>
<td>QMUX</td>
</tr>
<tr>
<td><code>/var/qmux_connect_socket</code></td>
<td>QMUX</td>
</tr>
<tr>
<td><code>/etc/config/simman</code></td>
<td>Unknown/SIM Card</td>
</tr>
<tr>
<td><code>/dev/modem*</code></td>
<td>GSM</td>
</tr>
<tr>
<td><code>/var/config/sms/*</code></td>
<td>SMS</td>
</tr>
</tbody>
</table>
<h3 id="sms">SMS</h3>
<p>Yes, SMS like text messages. SMS stands for short message service used by mobile device and internet-connected devices. MikroTik supports sending SMS messages via GSM modem. Users report configuring their MikroTik to use text messages for router management including receiving health alert text messages from the router and/or being able to reset the admin/user password via SMS. See the MikroTik <a href="https://wiki.mikrotik.com/wiki/Manual:Tools/Sms">Wiki</a> for more information.</p>
<h3 id="gsm">GSM</h3>
<p>GSM stands for Global System for Mobile Communications. GSM is the standard protocol for mobile communications. On a Mikrotik Router <code>/dev/ttyGSM*</code> may return the virtual serial ports in use by the RouterOS modem (<a href="https://www.kernel.org/doc/html/v5.3/driver-api/serial/n_gsm.html">kernel.org</a>, 2011). Users in <a href="https://unix.stackexchange.com/questions/535906/direct-serial-connection-to-a-router-using-screen-command">StackExchange</a> discuss gaining a direct serial connection to a RB4011 MikroTik router using <code>sudo screen /dev/ttyUSB0 115200 cs8 ixoff</code> implying that <code>ls -la /dev/ttyUSB*</code> can be used to identify a live serial connection to an active router.</p>
<h3 id="qmux">QMUX</h3>
<p><code>/usr/bin/qmuxd</code> points to the QMUX daemon. <code>gmuxd</code> is a linux user-space process to multiplex between programs interfacing with QMI (Qualcomm MSM Interface) and one or more shared-memory based QMUX ports offered by the broadband processor (<a href="https://osmocom.org/projects/quectel-modems/wiki/Qmuxd">Osmocom</a>,2019). This <a href="https://github.com/postmarketOS/pmbootstrap/issues/1054">Github issue</a> from 2017 suggests it is related to critical modem-related messaging services. This other <a href="https://github.com/postmarketOS/pmbootstrap/issues/598">issue</a> cites <code>qmuxd</code> as being the daemon responsible for talking to the modem via shared memory on Android.</p>
<h3 id="etcconfigsimman">/etc/config/simman</h3>
<p>Limited information on <code>/etc/config/simman</code> was discovered on common search engines. For instance, DuckDuckGo will only return 2 unique results. The only conclusive results returned with this string were live honeypot dashboards and websites written in Russian. I&rsquo;ve translated the relevant results below.</p>
<p><img src="/img/011-simman1.png" alt="simman search photo 1"></p>
<hr>
<blockquote>
<p>Как изменить APN? : Техническая поддержка
nano /etc/config/simman. Меняем параметры option GPRS_apn. config sim0 option priority &lsquo;1&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; config sim1 option priority &lsquo;0&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; Сохраняем файл с настройками: Ctrl+X потом подтверждаем сохранение под тем же именем</p>
</blockquote>
<blockquote>
<p>How to change APN?: Technical Support
nano / etc / config / simman. Change the parameters of option GPRS_apn. config sim0 option priority &lsquo;1&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; config sim1 option priority &lsquo;0&rsquo; option GPRS_apn &lsquo;tele91.msk&rsquo; Save the settings file: Ctrl + X then confirm saving under the same name</p>
</blockquote>
<hr>
<blockquote>
<p>Настройки Менеджера SIM карт : Техническая поддержка
Для настройки Менеджера SIM с помощью консоли, необходимо открыть файл /etc/config/simman: nano /etc/config/simman. В открывшемся окне Вы можете произвести конфигурацию: config simman &lsquo;core&rsquo;</p>
</blockquote>
<blockquote>
<p>SIM Card Manager Settings: Technical Support
To configure the SIM Manager using the console, open the file /etc/config/simman: nano /etc/config/simman. In the window that opens, you can configure: config simman &lsquo;core&rsquo;</p>
</blockquote>
<hr>
<p>This was an additional result returned from Google:</p>
<blockquote>
<p>Роутеры TELEOFIS RTU968, RTU1068 V2. Руководство &hellip;</p>
</blockquote>
<blockquote>
<p>Routers TELEOFIS RTU968, RTU1068 V2. Manual &hellip;</p>
</blockquote>
<hr>
<p>The translated results suggest the botnet is checking for the existence of a configuration file related to SIM card management.</p>
<p>On a new GCP Ubuntu 18.04 VM the same <code>la -la</code> command returns no file matches:
<img src="/img/011-lsla.png" alt="ls -la output"></p>
<h2 id="echo-hi--cat--n"><code>echo Hi | cat -n</code></h2>
<p>To help explain this behavior, I&rsquo;ve displayed the expected output of <code>echo Hi | cat -n</code>.</p>
<pre><code>$echo Hi | cat -n
1 Hi
</code></pre>
<p>Why would a robot want to print &ldquo;Hi&rdquo; to console? Let&rsquo;s take a step back and look at the series of commands executed. The commands first search for information about the machine with <code>ifconfig</code> and <code>uname</code>. It looks for running processes with &lsquo;miner&rsquo; in their process name. It checks for specific files, all checks that will fail on the honeypot. After executing these commands, the unauthorized entity prints a greeting to standard out in an unusual manner.</p>
<p>One explaination is that after determining the machine is a honeypot the botnet leaves a mark to record it has identified the machine as a honeypot. The mark could be a flag to prevent the botnet from dropping their malware on research honeypots.</p>
<hr>
<h1 id="analysis">Analysis</h1>
<h2 id="related-security-researcher-reports">Related Security Researcher Reports</h2>
<p>Similar behavior has been previously reported by security researcher <a href="https://twitter.com/remco_verhoef">@remco_verhoef</a>. On June 13th 2018 Verhoef writes,</p>
<blockquote>
<p>&ldquo;We&rsquo;ve found interesting new traffic within our Honeytrap agents, originating from servers within Russia only (to be specific, the netblock owned by NKS / NCNET Broadband)&hellip; they are executing all of the following ssh commands:&quot;(<a href="https://isc.sans.edu/forums/diary/From+Microtik+with+Love/23762/">SANS</a>, 2018)</p>
</blockquote>
<pre><code>/ip cloud print
help
ifconfig
uname -a
show ip
cat /proc/cpuinfo
uptime
ls -la
ls /data/data/com.android.providers.telephony/databases
echo Hi | cat -n
ps | grep '[Mm]iner'
ps -ef | grep '[Mm]iner'
</code></pre>
<p>In his post, Verhoef notes that since <code>RouterOS v6.27</code> the <code>/ip cloud print</code> command has deprecated indicating that the targetted devices are those running software older than <code>v6.27</code>. Verhoef adds that because, &ldquo;not all of the above commands are programmed to return the output expected by the script, it could be just probing for specifics about the attacked server,&rdquo; (<a href="https://isc.sans.edu/forums/diary/From+Microtik+with+Love/23762/">SANS</a>, 2018).</p>
<h1 id="mikrotik--coinhive-campaign-reports">MikroTik &amp; Coinhive Campaign Reports</h1>
<p>MikroTik is a router vender used Eastern Europe, based in Latvia. On May 23rd 2018, <a href="https://blog.talosintelligence.com/2018/05/VPNFilter.html">Cisco Talos</a> reported that some MikroTik devices are vulnerable to VPNFilter malware, they warn routers were being compromised by Coinhive cryptocurrency malware. Talos identifies MikroTik RouterOS versions 1016, 1036, and 1072 for cloud core routers as vulnerable.</p>
<p>Two days later on May 25th, 2018 the FBI issued a <a href="https://www.ic3.gov/Media/Y2018/PSA180525">public service announcement</a> summarizing,</p>
<blockquote>
<p>&ldquo;Foreign cyber actors have compromised hundreds of thousands of home and office routers and other networked devices worldwide. The actors used VPNFilter malware to target small office and home office routers. The malware is able to perform multiple functions, including possible information collection, device exploitation, and blocking network traffic.&rdquo;</p>
</blockquote>
<h1 id="analyst-opinion">Analyst Opinion</h1>
<p>The security event analyzed in this post has been executed numerous times by several IP addresses on the HoneyTrap server hosted in GCP. The botnet appears quite active, crawling the internet for RouterOS devices with a weak username and password configuration. The motive of these events has not been confirmed, however, as suggested by the FBI there are numerous malicious operations that could be conducted on a compromised router.</p>
<h1 id="logged-ip-addresses">Logged IP Addresses</h1>
<p>Remember, botnets may operate from compromised endpoints. This means the IPs listed below may not necessarily be the endpoint of the &ldquo;real&rdquo; attacking entity, but could instead potentially be zombified victim endpoints or VPN endpoints.</p>
<p>The event described in this post has been captured multiple times by the following addresses:</p>
<pre><code>51.222.139.65
174.124.123.109
185.110.91.235
</code></pre>
<p>The event described in this post is associated with the following hosts once:</p>
<pre><code>5.228.46.151
83.165.192.43
97.121.144.188
98.125.186.145
162.104.171.249
176.31.46.240
188.32.225.20
219.94.94.161
</code></pre>

  </main>
  <div id="disqus-container">
  
</div>


          
            <footer role="contentinfo">
  <div
  
  >
    <label for="themer">
      dark theme: <input type="checkbox" id="themer" class="vh">
      
      <span aria-hidden="true"></span>
    </label>
  </div>
  
</footer>

          
        </div>
      </div>
    </div>
    

<script src="/js/dom-scripts.js"></script>  

<script src="/js/prism.js"></script>



<script src="/js/search.7aef046a0cc8b0c532f1d20087b920459bc868c936bb48a6ae221eceefca2d07.js"></script>

<link rel="stylesheet" href="/css/search.fe0cd54a21628574bff49d721c827d1bb165ab56b0f22dd55ae78addbe61c309.css"></link>



  <script src="/js/custom_01.js"></script>

  <script src="/js/custom_02.js"></script>


    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js" integrity="sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

    
  

  </body>
</html>
