<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Writing my first forensic tool in Go | coffeefolia</title><meta name=keywords content="penut,Go,debug/pe,digital forensics,DFIR"><meta name=description content="Learning more about the debug/pe package."><meta name=author content="Emily Eubanks"><link rel=canonical href=/blog/001-penut/><link href=/assets/css/stylesheet.min.2a79645f388444ef452f62dadbadeebdfebba13b08d1b841a7504a7be022e74d.css integrity="sha256-KnlkXziERO9FL2La263uvf67oTsI0bhBp1BKe+Ai500=" rel="preload stylesheet" as=style><link rel=icon href=/coffeaarabica400x400.png><link rel=icon type=image/png sizes=16x16 href=/coffeaarabica400x400.png><link rel=icon type=image/png sizes=32x32 href=/coffeaarabica400x400.png><link rel=apple-touch-icon href=/coffeaarabica400x400.png><link rel=mask-icon href=/coffeaarabica400x400.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="Writing my first forensic tool in Go"><meta property="og:description" content="Learning more about the debug/pe package."><meta property="og:type" content="article"><meta property="og:url" content="/blog/001-penut/"><meta property="og:image" content="/img/001-fileheaderraw.png"><meta property="article:published_time" content="2021-01-20T00:00:03+00:00"><meta property="article:modified_time" content="2021-01-20T00:00:03+00:00"><meta property="og:site_name" content="coffeefolia"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/img/001-fileheaderraw.png"><meta name=twitter:title content="Writing my first forensic tool in Go"><meta name=twitter:description content="Learning more about the debug/pe package."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Writing my first forensic tool in Go","name":"Writing my first forensic tool in Go","description":"Overview While reading Hands On System Programming with Go, I discovered the debug/pe package. To learn more about using Go I decided to spend a few days building a static forensic …","keywords":["penut","Go","debug/pe","digital forensics","DFIR"],"articleBody":"Overview While reading Hands On System Programming with Go, I discovered the debug/pe package. To learn more about using Go I decided to spend a few days building a static forensic tool centered around use of this package. The debug/pe package provides functions that make analyzing a PE file easier. A glimpse of promising functions include: Open, ImportedLibraries, FileHeader, OpentionHeader32/64, and StringTable. Limiting myself to a span of a week, I’m reporting on functions I’ve applied to penut, a simple PE file static analysis tool, and what the next steps are to build upon the application.\nThe debug/pe Package pe.Open() will load your executable and prep it for use as type *File. A File has the following struct:\ntype File struct { FileHeader OptionalHeader interface{} // of type *OptionalHeader32 or *OptionalHeader64; added in Go 1.3 Sections []*Section Symbols []*Symbol // COFF symbols with auxiliary symbol records removed; added in Go 1.1 COFFSymbols []COFFSymbol // all COFF symbols (including auxiliary symbol records); added in Go 1.8 StringTable StringTable // Go 1.8 // contains filtered or unexported fields } This is significant because it suggests that bare details of the executable are already available to the operator, ready to print to screen. Here is an example of pe.Open within the content of the application.\n\tpfile, err := pe.Open(os.Args[1]) if err != nil { fmt.Fprintf(os.Stderr, \"pe.Open:%s\\n\", err) os.Exit(1) } defer pfile.Close() As a result of the above code, the attributes defined in pfile give us a glimpse into the specified executable. For instance, we can pull File Header information from the new File instance pfile. The code below is an example of a function that would read in pfile and print out the File Header information.\nfunc printFileHeader(f *pe.File) { a := f.FileHeader fmt.Print(\"File Header: \") fmt.Println(a) } Output:\n$go run main.go main.exe File Header: {332 15 0 2010112 3392 224 770} Looking at the above output of printFileHeader() we see the value of the pfile OptionalHeader interface{}.\nprintHexAndDec(“Header Characteristics: “, f.FileHeader.Characteristics, Bitmask(f.FileHeader.Characteristics).ListDescriptions(charValues))\nNext Steps As I continued to experiment with the available types, structs, and functions provided by debug/pe I found that I would need to better famliarize myself with the Go language in order to properly utilize what has been already built for me. For instance, the StringTable attribute prints out what seems to be a LONG string of bytes.\nfunc printStringTable(f *pe.File) { a := f.StringTable fmt.Println(a) } This long string of bytes can be cast into a string for human reading.\nfunc printStringTable(f *pe.File) { a := string(f.StringTable) fmt.Println(a) } The long string appears to be deliniated by a period .. I quickly parsed it for some readability of contents but the data is not yet actionable:\nfunc printStringTable(f *pe.File) { a := string(f.StringTable) b := strings.Replace(a, \".\", \"\\n\", -1) fmt.Println(b) } [ … ]  Thanks for reading! This was a fun experiment with Go. I hope you found the information educational.\nFor even more information, see the following references:\n https://golang.org/pkg/debug/pe/ https://en.wikipedia.org/wiki/Portable_Executable https://github.com/coffeefolia/penut  ","wordCount":"494","inLanguage":"en","image":"/img/001-fileheaderraw.png","datePublished":"2021-01-20T00:00:03Z","dateModified":"2021-01-20T00:00:03Z","author":{"@type":"Person","name":"Emily Eubanks"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/001-penut/"},"publisher":{"@type":"Organization","name":"coffeefolia","logo":{"@type":"ImageObject","url":"/coffeaarabica400x400.png"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=/ accesskey=h title="coffeefolia (Alt + H)"><img src=coffeaarabica400x400.png alt=logo aria-label=logo height=35>coffeefolia</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=/posts/ title=POSTS><span>POSTS</span></a></li><li><a href=/tags/ title=TAGS><span>TAGS</span></a></li><li><a href=/ title=HOME><span>HOME</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Writing my first forensic tool in Go</h1><div class=post-description>Learning more about the debug/pe package.</div><div class=post-meta>January 20, 2021&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Emily Eubanks</div></header><figure class=entry-cover><img src=/img/001-fileheaderraw.png alt="Image from Blog - String Table"><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><blockquote><ul><ul><li><a href=#overview aria-label=Overview>Overview</a></li><li><a href=#the-debugpe-package aria-label="The debug/pe Package">The <code>debug/pe</code> Package</a></li></ul><li><a href=#next-steps aria-label="Next Steps">Next Steps</a></li></ul></blockquote></details></div><div class=post-content><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><p>While reading Hands On System Programming with Go, I discovered the <code>debug/pe</code> package. To learn more about using Go I decided to spend a few days building a static forensic tool centered around use of this package. The <a href=https://golang.org/pkg/debug/pe/>debug/pe</a> package provides functions that make analyzing a PE file easier. A glimpse of promising functions include: Open, ImportedLibraries, FileHeader, OpentionHeader32/64, and StringTable. Limiting myself to a span of a week, I&rsquo;m reporting on functions I&rsquo;ve applied to <code>penut</code>, a simple PE file static analysis tool, and what the next steps are to build upon the application.</p><h3 id=the-debugpe-package>The <code>debug/pe</code> Package<a hidden class=anchor aria-hidden=true href=#the-debugpe-package>#</a></h3><p><code>pe.Open()</code> will load your executable and prep it for use as type *File. A File has the following struct:</p><pre><code>type File struct {
    FileHeader
    OptionalHeader interface{} // of type *OptionalHeader32 or *OptionalHeader64; added in Go 1.3
    Sections       []*Section
    Symbols        []*Symbol    // COFF symbols with auxiliary symbol records removed; added in Go 1.1
    COFFSymbols    []COFFSymbol // all COFF symbols (including auxiliary symbol records); added in Go 1.8
    StringTable    StringTable // Go 1.8
    // contains filtered or unexported fields
}
</code></pre><p>This is significant because it suggests that bare details of the executable are already available to the operator, ready to print to screen. Here is an example of <code>pe.Open</code> within the content of the application.</p><pre><code>	pfile, err := pe.Open(os.Args[1])
	if err != nil {
		fmt.Fprintf(os.Stderr, &quot;pe.Open:%s\n&quot;, err)
		os.Exit(1)
	}
	defer pfile.Close()
</code></pre><p>As a result of the above code, the attributes defined in <code>pfile</code> give us a glimpse into the specified executable. For instance, we can pull File Header information from the new File instance <code>pfile</code>. The code below is an example of a function that would read in <code>pfile</code> and print out the File Header information.</p><pre><code>func printFileHeader(f *pe.File) {
	a := f.FileHeader
	fmt.Print(&quot;File Header: &quot;)
	fmt.Println(a)
}
</code></pre><p>Output:</p><pre><code>$go run main.go main.exe 
File Header: {332 15 0 2010112 3392 224 770}
</code></pre><p>Looking at the above output of <code>printFileHeader()</code> we see the value of the <code>pfile</code> <code>OptionalHeader interface{}</code>.</p><p>printHexAndDec(&ldquo;Header Characteristics: &ldquo;, f.FileHeader.Characteristics, Bitmask(f.FileHeader.Characteristics).ListDescriptions(charValues))</p><h2 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h2><p>As I continued to experiment with the available types, structs, and functions provided by <code>debug/pe</code> I found that I would need to better famliarize myself with the Go language in order to properly utilize what has been already built for me. For instance, the StringTable attribute prints out what seems to be a LONG string of bytes.</p><pre><code>func printStringTable(f *pe.File) {
a := f.StringTable
fmt.Println(a)
}
</code></pre><p><img src=/img/001-stringtablebytes.png alt="StringTable Bytes Output"></p><p>This long string of bytes can be cast into a string for human reading.</p><pre><code>func printStringTable(f *pe.File) {
    a := string(f.StringTable)
    fmt.Println(a)
}
</code></pre><p><img src=/img/001-stringtablestring.png alt="StringTable Bytes Cast to String"></p><p>The long string appears to be deliniated by a period <code>.</code>. I quickly parsed it for some readability of contents but the data is not yet actionable:</p><pre><code>func printStringTable(f *pe.File) {
	a := string(f.StringTable)
	b := strings.Replace(a, &quot;.&quot;, &quot;\n&quot;, -1)
	fmt.Println(b)
}
</code></pre><p><img src=/img/001-stringtableparseda.png alt="StringTable String Parsed">
[ &mldr; ]
<img src=/img/001-stringtableparsedb.png alt="StringTable String Parsed"></p><hr><p>Thanks for reading! This was a fun experiment with Go. I hope you found the information educational.</p><p>For even more information, see the following references:</p><ul><li><a href=https://golang.org/pkg/debug/pe/>https://golang.org/pkg/debug/pe/</a></li><li><a href=https://en.wikipedia.org/wiki/Portable_Executable>https://en.wikipedia.org/wiki/Portable_Executable</a></li><li><a href=https://github.com/coffeefolia/penut>https://github.com/coffeefolia/penut</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/penut/>penut</a></li><li><a href=/tags/go/>Go</a></li><li><a href=/tags/debug/pe/>debug/pe</a></li><li><a href=/tags/digital-forensics/>digital forensics</a></li><li><a href=/tags/dfir/>DFIR</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=/>coffeefolia</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>