---
title: "go-sshoney on GCP honeypot tutorial"
date: 2021-01-22T00:00:03+00:00
weight: 1
aliases: ["/go-ssh-honeypots"]
tags: ["honeypot", "Go", "SSH", "analysis", "GCP", "tutorial"]
author: "Emily Eubanks"
# author: ["Me", "You"] # multiple authors
showToc: true
TocOpen: false
draft: true
hidemeta: false
disableShare: false
cover:
    image: "coffeaarabica1500x500.jpeg" # image path/url
    alt: "Temp Image" # alt text
    caption: "<text>" # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: false # only hide on current single page
comments: false
description: "A one week tour in an e2 Micro GCP Honeypot"
disableHLJS: true # to disable highlightjs
---
## Overview
While exploring honeypots written in Go I came across go-sshoney. Last updated in 2017, at the time of this writing [`go-sshoney`](https://github.com/jaksi/go-sshoney) has 20 stars. It describes itself as, 

> "an SSH honeypot designed purely to log the SSH connection attempts on a given port. SSHoney works by listening on a non-privileged port (2222 by default) and pretends to be an SSH server. When an SSH client connects, SSHoney logs the connection details (IP, username, password and SSH clienr version) to stdout and/or syslog, a log file of your choosing (e.g /var/log/sshoney.log)."

### Assumptions
* You have go installed locally.
* You are using go-sshoney in a controlled security environment, and NOT a production environment or a shared network.

## Pre-Configuration
Create a secure environment to run the honeypot. I am running my honeypot from a GCP f-micro instance running Ubuntu, to login one must use an SSH key(to avoid any password spraying issues). The instructions in this article and any discussed contraints will reflect this remote environment.

Currently, we are logged into our remote GCP f2-micro instance via SSH over port 22. Since we want to log any interactions with the SSH service we will want to use the default port 22 for our fake honeypot service go-sshoney and move the real ssh service to another port. First, we'll change the port number used by the real ssh service by making changes to `.sshconfig`.

`sudo vim /etc/ssh/sshd_config`

Where the file reads... 

```# What ports, IPs, and protocols we listen for```

...change `Port 22` to `Port 23` and uncomment `ListenAddress 0.0.0.0` and `ListenAddress ::`.

![sshdconfig](/img/003-sshdconfigmod.png)

Next, we'll update the firewall, `ufw`, to open up our new ssh port. Since we are already accepting connections on port 22 no other related changes are necessary.

```
$ sudo ufw allow 23/tcp
Rules updated
Rules updated (v6)
```

Restart the ssh service.

```
sudo systemctl restart ssh
```

Verify SSH daemon is listening on port 23, you should see the following output.

```
$ ss -an | grep 23
tcp    LISTEN     0      128       *:23                  *:*                  
tcp    LISTEN     0      128      :::23                 :::*
```

Great we're almost there, now we need to go to our GCP console and navigate to the firewall for the managed instance. In order to connect to the instance, you'll need to tell GCP that you want to use a different port to connect. Change the "default" rule to allow tcp traffic on port 23.

![default-allow-ssh rule](/img/003-networkinterfacedetails.png)

Now add another rule for `honeypot` traffic on port 22.

![default-allow-honeypot rule](/img/003-allowhoneypots.png)

You should now be able to login from the custom port 23 and honeypot traffic should be able to communicate out port 22.

## Installation
To install and build the SSH honeypot from source follow the instuctions below. First, [quickly install go](https://golang.org/doc/install). Now, download and run code for [`go-sshoney`](https://github.com/ashmckenzie/go-sshoney.git) using the default ssh port 22 for the fake service. For your convience I have reproduced the command line instructions here, for more detail please reference the [README](https://github.com/ashmckenzie/go-sshoney). Note that Ash Mckenzie recommends running this program without privlidged permissions (i.e. `nobody`).

Installing golang:

```
wget https://golang.org/dl/go1.15.7.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.15.7.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
```

Verifying the go installation:

```
$ go version
go version go1.15.7 linux/amd64
```

```
sudo apt-get install build-essential
go get -u github.com/ashmckenzie/sshoney
cd /tmp; make -f /usr/bin/go/src/github.com/ashmckenzie/sshoney/Makefile gen_ssh_key
whoami
sudo -u nobody PORT=22 sshoney --log-file /var/log/sshoney.log
```
You can verify the honeypot is running properly by trying to login to the machine from port 22. 

## Conclusion